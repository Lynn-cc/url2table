<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>url参数解表格</title>
    <link rel="stylesheet" href="http://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css">
</head>
<body>
<textarea id="urls" name="urls" cols="30" rows="10"></textarea>
<table id="table"> </table>
    
<script src="http://code.jquery.com/jquery-1.12.4.js"></script>
<script src="http://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
<script>
    $('textarea').on('change', handler);
    function handler() {
        var urls = $('#urls').val().split('\n');
        var table = [];
        $.each(urls, function(index, url) {
            var search = url.split('?')[1];
            if (!search) return;
            var params = search.split('&');
            table[index] = {};
            $.each(params, function(i, str) {
                if (!str) return;
                var s = str.split('=');
                table[index][s[0]] = s[1];
            });
        });
        buildTable(table)
    }

    var tabs = ['page_id', 'oper_id', 'oper_obj_id', 'oper_obj_type', 'ret_id'];

    function buildTable(data) {
        var tbody = $.map(data, function(line) {
            var result = [];
            $.each(line, function(key, val) {
                var tdIndex = tabs.indexOf(key);
                if (tdIndex > -1) {
                    result[tdIndex] = val;
                } else {
                    tabs.push(key);
                    result[tabs.length-1] = val;
                }
            });
            return '<tr>' + $.map(result, function(val) {
                    return '<td>' + (typeof val === 'undefined' ? '' : val) + '</td>';
                    }).join('') + '</tr>';
        }).join('');

        var thead = $.map(tabs, function(tab) {
            return '<td>' + tab + '</td>';
        }).join('');

        $('table').html('<thead><tr>' + thead + '</tr></thead><tbody>' + tbody + '</tbody>').DataTable();
    }
</script>
</body>
</html>
